<?php

/**
 * Isolated HttpResponse Test
 *
 * Tests HttpResponse functionality
 *
 * @package   OpenEMR
 * @link      http://www.open-emr.org
 * @author    GitHub Copilot <copilot@github.com>
 * @copyright Copyright (c) 2025 GitHub Copilot
 * @license   https://github.com/openemr/openemr/blob/master/LICENSE GNU General Public License 3
 *
 * Code generated by GitHub Copilot AI
 */

declare(strict_types=1);

namespace OpenEMR\Tests\Isolated\Common\Http;

use OpenEMR\Common\Http\HttpResponse;
use PHPUnit\Framework\TestCase;

class HttpResponseTest extends TestCase
{
    public function testConstructorSetsProperties(): void
    {
        $response = new HttpResponse(
            200,
            '{"status": "ok"}',
            ['Content-Type' => 'application/json'],
            null
        );
        
        $this->assertEquals(200, $response->getStatusCode());
        $this->assertEquals('{"status": "ok"}', $response->getBody());
        $this->assertEquals(['Content-Type' => 'application/json'], $response->getHeaders());
        $this->assertNull($response->getError());
    }

    public function testConstructorWithError(): void
    {
        $response = new HttpResponse(
            0,
            '',
            [],
            'Connection timeout'
        );
        
        $this->assertEquals(0, $response->getStatusCode());
        $this->assertEquals('', $response->getBody());
        $this->assertEquals([], $response->getHeaders());
        $this->assertEquals('Connection timeout', $response->getError());
    }

    public function testIsSuccessReturnsTrueFor2xxStatus(): void
    {
        $response = new HttpResponse(200, 'OK', [], null);
        $this->assertTrue($response->isSuccess());
        
        $response = new HttpResponse(201, 'Created', [], null);
        $this->assertTrue($response->isSuccess());
        
        $response = new HttpResponse(204, '', [], null);
        $this->assertTrue($response->isSuccess());
    }

    public function testIsSuccessReturnsFalseForNon2xxStatus(): void
    {
        $response = new HttpResponse(404, 'Not Found', [], null);
        $this->assertFalse($response->isSuccess());
        
        $response = new HttpResponse(500, 'Server Error', [], null);
        $this->assertFalse($response->isSuccess());
    }

    public function testIsSuccessReturnsFalseWithError(): void
    {
        $response = new HttpResponse(200, 'OK', [], 'Some error');
        $this->assertFalse($response->isSuccess());
    }

    public function testHasErrorReturnsTrueWithError(): void
    {
        $response = new HttpResponse(200, 'OK', [], 'Error message');
        $this->assertTrue($response->hasError());
    }

    public function testHasErrorReturnsTrueWithZeroStatus(): void
    {
        $response = new HttpResponse(0, '', [], null);
        $this->assertTrue($response->hasError());
    }

    public function testHasErrorReturnsFalseForSuccessfulResponse(): void
    {
        $response = new HttpResponse(200, 'OK', [], null);
        $this->assertFalse($response->hasError());
    }

    public function testGetStatusCodeReturnsCorrectValue(): void
    {
        $response = new HttpResponse(404, '', [], null);
        $this->assertEquals(404, $response->getStatusCode());
    }

    public function testGetBodyReturnsCorrectValue(): void
    {
        $body = '{"data": "test"}';
        $response = new HttpResponse(200, $body, [], null);
        $this->assertEquals($body, $response->getBody());
    }

    public function testGetHeadersReturnsCorrectValue(): void
    {
        $headers = [
            'Content-Type' => 'application/json',
            'Cache-Control' => 'no-cache'
        ];
        $response = new HttpResponse(200, '', $headers, null);
        $this->assertEquals($headers, $response->getHeaders());
    }

    public function testGetErrorReturnsCorrectValue(): void
    {
        $error = 'Connection refused';
        $response = new HttpResponse(0, '', [], $error);
        $this->assertEquals($error, $response->getError());
    }
}
