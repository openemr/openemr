# Vietnamese Physiotherapy Module - Production Deployment Checklist

**AI-GENERATED CONTENT**: This checklist was generated by Claude Code

**Version**: 1.0.0
**Date**: 2025-11-22
**Module**: Vietnamese Physiotherapy

---

## Pre-Deployment Checklist

### System Requirements

- [ ] PHP version >= 8.0
- [ ] MySQL/MariaDB >= 5.7
- [ ] OpenEMR version >= 7.0.0
- [ ] Required PHP extensions installed:
  - [ ] mysqli
  - [ ] pdo
  - [ ] pdo_mysql
  - [ ] mbstring
  - [ ] json
- [ ] Composer installed
- [ ] Sufficient disk space (minimum 500MB)
- [ ] Database backup capability available

### Environment Preparation

- [ ] OpenEMR installation verified
- [ ] Database credentials confirmed
- [ ] File permissions checked:
  - [ ] `sites/default/documents` writable
  - [ ] `interface/forms` writable
  - [ ] `library/custom` writable
- [ ] Git repository status checked
- [ ] Current branch identified
- [ ] All changes committed (production only)

### Code Quality

- [ ] All unit tests passing
- [ ] All API tests passing
- [ ] Code coverage >= 80%
- [ ] PSR-12 code style compliance verified
- [ ] No security vulnerabilities detected
- [ ] Documentation up to date

### Backup Preparation

- [ ] Database backup created
- [ ] Configuration files backed up
- [ ] Custom files backed up
- [ ] Backup verification completed
- [ ] Rollback procedure documented
- [ ] Backup retention policy confirmed

---

## Deployment Steps

### 1. Pre-Deployment Backup

```bash
cd /var/www/html/openemr/sql/migrations/vietnamese_pt
./backup.sh --compress
```

**Verification**:
- [ ] Backup files created in `backups/` directory
- [ ] Manifest file generated
- [ ] Backup size is reasonable (> 0 bytes)
- [ ] Backup timestamp recorded

### 2. Run Installation Script

#### Development Environment

```bash
cd /var/www/html/openemr/sql/migrations/vietnamese_pt
./INSTALL_PRODUCTION.sh
```

#### Staging Environment

```bash
cd /var/www/html/openemr/sql/migrations/vietnamese_pt
./deploy.sh staging
```

#### Production Environment

```bash
cd /var/www/html/openemr/sql/migrations/vietnamese_pt
./deploy.sh production --notify-email admin@example.com
```

**Verification**:
- [ ] Installation script completed without errors
- [ ] All migrations applied successfully
- [ ] Forms registered in database
- [ ] Composer autoload updated
- [ ] Cache cleared
- [ ] Installation log reviewed

### 3. Database Migration Verification

```bash
# Check database tables
mysql -u openemr -p openemr -e "SHOW TABLES LIKE 'pt_%bilingual';"

# Expected output: 7 tables
# - pt_assessments_bilingual
# - pt_exercise_prescriptions_bilingual
# - pt_treatment_plans_bilingual
# - pt_outcome_measures_bilingual
# - pt_treatment_sessions_bilingual
# - pt_assessment_templates_bilingual
# - pt_configuration

# Check stored procedures
mysql -u openemr -p openemr -e "
  SELECT ROUTINE_NAME FROM information_schema.ROUTINES
  WHERE ROUTINE_SCHEMA = 'openemr'
  AND ROUTINE_NAME IN ('get_vietnamese_term', 'get_english_term');
"
```

**Verification**:
- [ ] All required tables exist
- [ ] All tables have correct collation (utf8mb4_vietnamese_ci)
- [ ] Stored procedures created
- [ ] Indexes created (check migration 001)
- [ ] Foreign keys created (check migration 002)
- [ ] Menu items added to `list_options`
- [ ] ACL entries added to `gacl_aco`
- [ ] Configuration table populated

### 4. Form Registration Verification

```bash
mysql -u openemr -p openemr -e "
  SELECT directory, name, state, category
  FROM registry
  WHERE directory LIKE 'vietnamese_pt_%'
  ORDER BY directory;
"
```

**Verification**:
- [ ] 4 forms registered:
  - [ ] vietnamese_pt_assessment
  - [ ] vietnamese_pt_exercise
  - [ ] vietnamese_pt_treatment_plan
  - [ ] vietnamese_pt_outcome
- [ ] All forms have `state = 1` (active)
- [ ] Correct categories assigned

### 5. File Deployment Verification

```bash
# Check service files
ls -la /var/www/html/openemr/src/Services/VietnamesePT/

# Expected: 8 service files
# - PTAssessmentService.php
# - PTExercisePrescriptionService.php
# - PTTreatmentPlanService.php
# - PTOutcomeMeasureService.php
# - PTMedicalTerminologyService.php
# - PTInsuranceIntegrationService.php
# - PTSessionNotesService.php
# - PTAssessmentTemplateService.php
# - PTConfigurationService.php

# Check controller files
ls -la /var/www/html/openemr/src/RestControllers/VietnamesePT/

# Expected: 9 controller files (8 + HealthCheckController)

# Check form directories
ls -d /var/www/html/openemr/interface/forms/vietnamese_pt_*/

# Expected: 4 form directories
```

**Verification**:
- [ ] All service files present
- [ ] All controller files present
- [ ] All form directories present
- [ ] Widget file present (`library/custom/vietnamese_pt_widget.php`)
- [ ] Validator files present
- [ ] File permissions correct

### 6. Health Check Verification

```bash
# Test health endpoint (no auth required)
curl -s http://localhost/apis/default/vietnamese-pt/health | jq

# Test version endpoint
curl -s http://localhost/apis/default/vietnamese-pt/version | jq

# Test detailed health (requires admin auth)
# curl -s -H "Authorization: Bearer YOUR_TOKEN" \
#   http://localhost/apis/default/vietnamese-pt/health/detailed | jq
```

**Verification**:
- [ ] Health endpoint returns `status: "healthy"`
- [ ] All component checks pass
- [ ] Version information correct
- [ ] Response time acceptable (< 500ms)

### 7. Functional Testing

**Manual Test Cases**:

#### Test 1: Create PT Assessment
- [ ] Navigate to patient encounter
- [ ] Select "Vietnamese PT Assessment" form
- [ ] Fill in required fields (English and Vietnamese)
- [ ] Save form
- [ ] Verify data saved correctly
- [ ] Check database record created

#### Test 2: Create Exercise Prescription
- [ ] Navigate to patient encounter
- [ ] Select "Vietnamese PT Exercise Prescription" form
- [ ] Add exercise with sets/reps
- [ ] Save form
- [ ] Verify prescription created

#### Test 3: REST API Test
```bash
# Test assessment creation via API
curl -X POST http://localhost/apis/default/vietnamese-pt/assessments \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "patient_id": 1,
    "chief_complaint_en": "Lower back pain",
    "chief_complaint_vi": "Đau lưng dưới",
    "pain_level": 7,
    "language_preference": "vi"
  }'
```

**Verification**:
- [ ] API endpoints responding
- [ ] Data validation working
- [ ] Vietnamese characters saved correctly
- [ ] Bilingual data retrieved correctly

### 8. Performance Testing

```bash
# Run performance test script
cd /var/www/html/openemr/sql/migrations/vietnamese_pt
./performance_test.sh
```

**Metrics to Verify**:
- [ ] Database query time < 100ms
- [ ] API response time < 500ms
- [ ] Form load time < 2 seconds
- [ ] Memory usage acceptable
- [ ] No memory leaks detected

### 9. Security Verification

**Security Checklist**:
- [ ] ACL permissions configured
- [ ] OAuth2 authentication working
- [ ] Input validation enabled
- [ ] SQL injection protection verified
- [ ] XSS protection enabled
- [ ] CSRF tokens validated
- [ ] No sensitive data in logs
- [ ] Database credentials secure

### 10. Documentation Update

- [ ] Installation date recorded
- [ ] Deployment log saved
- [ ] Version information updated
- [ ] Change log updated
- [ ] Known issues documented
- [ ] Support contacts updated

---

## Post-Deployment Verification

### Immediate Checks (0-1 hour)

- [ ] Health check endpoint monitoring active
- [ ] No error logs appearing
- [ ] Application logs clean
- [ ] Database connections stable
- [ ] User access verified
- [ ] Forms accessible from UI
- [ ] REST API responding

### Short-term Monitoring (1-24 hours)

- [ ] Performance metrics stable
- [ ] No memory leaks
- [ ] Database growth normal
- [ ] User feedback collected
- [ ] Error rate < 0.1%
- [ ] Response times acceptable

### Long-term Monitoring (1-7 days)

- [ ] Weekly backup schedule verified
- [ ] Log rotation working
- [ ] Performance trends stable
- [ ] User adoption tracking
- [ ] Feature usage analytics
- [ ] Support tickets reviewed

---

## Rollback Procedure

### When to Rollback

Trigger rollback if:
- [ ] Health check shows "unhealthy" status
- [ ] Critical functionality broken
- [ ] Data integrity issues detected
- [ ] Performance degradation > 50%
- [ ] Security vulnerability discovered

### Rollback Steps

1. **Stop Application** (if necessary)
   ```bash
   # For Apache
   sudo systemctl stop apache2

   # For Nginx
   sudo systemctl stop nginx
   ```

2. **Restore Database**
   ```bash
   cd /var/www/html/openemr/sql/migrations/vietnamese_pt
   ./restore.sh --list
   ./restore.sh --backup-timestamp YYYYMMDD_HHMMSS
   ```

3. **Verify Restoration**
   ```bash
   # Check database tables
   mysql -u openemr -p openemr -e "SHOW TABLES LIKE 'pt_%';"

   # Run health check
   curl -s http://localhost/apis/default/vietnamese-pt/health | jq
   ```

4. **Clear Cache**
   ```bash
   cd /var/www/html/openemr
   rm -rf sites/default/documents/smarty/main/*
   composer dump-autoload -o
   ```

5. **Restart Application**
   ```bash
   sudo systemctl start apache2
   # or
   sudo systemctl start nginx
   ```

6. **Verify Rollback**
   - [ ] Application accessible
   - [ ] Health check passing
   - [ ] No error logs
   - [ ] Forms accessible
   - [ ] API responding

---

## Monitoring Setup

### Health Check Monitoring

```bash
# Add to crontab for continuous monitoring
*/5 * * * * /usr/local/bin/check_vietnamese_pt_health.sh

# Create monitoring script
cat > /usr/local/bin/check_vietnamese_pt_health.sh <<'EOF'
#!/bin/bash
STATUS=$(curl -s http://localhost/apis/default/vietnamese-pt/health | jq -r '.status')
if [ "$STATUS" != "healthy" ]; then
    echo "ALERT: Vietnamese PT Module unhealthy" | \
        mail -s "OpenEMR Alert" admin@example.com
fi
EOF
chmod +x /usr/local/bin/check_vietnamese_pt_health.sh
```

**Verification**:
- [ ] Cron job added
- [ ] Monitoring script tested
- [ ] Alert emails working
- [ ] Slack notifications configured (if applicable)

### Log Monitoring

```bash
# Monitor installation logs
tail -f /var/www/html/openemr/sql/migrations/vietnamese_pt/installation_*.log

# Monitor application logs
tail -f /var/www/html/openemr/sites/default/documents/logs_and_misc/logEvents.txt | grep "vietnamese_pt"
```

**Verification**:
- [ ] Log rotation configured
- [ ] Log retention policy set
- [ ] Error alerting enabled
- [ ] Log aggregation configured (if applicable)

---

## Support and Escalation

### Level 1 Support (Self-Service)

1. Check health endpoint: `GET /apis/default/vietnamese-pt/health`
2. Review installation logs
3. Check database connectivity
4. Clear cache and restart services
5. Review documentation

### Level 2 Support (Technical Team)

1. Run detailed health check
2. Review database logs
3. Check application logs
4. Analyze performance metrics
5. Review recent changes

### Level 3 Support (Escalation)

1. Contact module maintainer
2. Provide logs and health check results
3. Document issue reproduction steps
4. Provide database schema dump
5. Share configuration details

### Contact Information

- **Documentation**: `/var/www/html/openemr/Documentation/physiotherapy/`
- **Logs**: `/var/www/html/openemr/sql/migrations/vietnamese_pt/`
- **Health Check**: `http://localhost/apis/default/vietnamese-pt/health`
- **Support Email**: [Configure based on your setup]

---

## Deployment Sign-Off

### Pre-Deployment

- **Prepared by**: ________________
- **Reviewed by**: ________________
- **Approved by**: ________________
- **Date**: ________________

### Post-Deployment

- **Deployed by**: ________________
- **Verified by**: ________________
- **Date**: ________________
- **Status**: [ ] Success [ ] Partial [ ] Failed

### Notes

```
[Add any deployment-specific notes here]
```

---

**AI-GENERATED CONTENT END**
