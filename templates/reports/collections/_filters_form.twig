{# Collections Report - Filters and Parameters Form #}
{#
    Expected Variables:
    - csrf_token_form: CSRF token for form security
    - filters: Object containing form filter values:
        - form_page_y, form_offset_y, form_y: Scroll position tracking
        - form_cb_ssn, form_cb_dob, form_cb_pubpid, form_cb_policy, form_cb_phone, form_cb_city: Column display checkboxes
        - form_cb_ins1, form_cb_referrer, form_cb_adate, form_cb_idays, form_cb_err, form_cb_group_number: More column checkboxes
        - form_date, form_to_date: Date range filters
        - form_category: Category filter (Open, Due Pt, Due Ins, Ins Summary, Credits, All)
        - form_ageby: Age by option (Service Date or Last Activity Date)
        - form_age_cols: Number of aging columns (default: 3)
        - form_age_inc: Days per aging column (default: 30)
        - form_cb_with_debt: Checkbox for filtering patients with debt only
    - facility_dropdown: HTML for facility dropdown (generated by dropdown_facility())
    - insurance_dropdown: HTML for insurance/payor dropdown (generated by insuranceSelect())
    - provider_dropdown: HTML for provider dropdown
    - show_results: Boolean indicating if results should be shown
#}

<div id="report_parameters" class="card mb-4">
    <div class="card-body">
        <form method="post" action="collections_report.php" id="theform" onsubmit="return top.restoreSession()">
            {# Hidden form fields #}
            <input type="hidden" name="csrf_token_form" value="{{ csrf_token_form|attr }}">
            <input type="hidden" name="form_refresh" id="form_refresh" value="">
            <input type="hidden" name="form_export" id="form_export" value="">
            <input type="hidden" name="form_csvexport" id="form_csvexport" value="">
            <input type="hidden" name="form_clear_ins_debt" id="form_clear_ins_debt" value="">
            <input type="hidden" name="form_page_y" id="form_page_y" value="{{ filters.form_page_y|default('')|attr }}">
            <input type="hidden" name="form_offset_y" id="form_offset_y" value="{{ filters.form_offset_y|default('')|attr }}">
            <input type="hidden" name="form_y" id="form_y" value="{{ filters.form_y|default('')|attr }}">

            <div class="row">
                <div class="col-lg-9">
                    {# Displayed Columns Section #}
                    <div class="form-group mb-4">
                        <label class="font-weight-bold mb-2">{{ 'Displayed Columns'|xlt }}:</label>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_ssn" id="form_cb_ssn"{{ filters.form_cb_ssn ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_ssn">{{ 'SSN'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_dob" id="form_cb_dob"{{ filters.form_cb_dob ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_dob">{{ 'DOB'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_pubpid" id="form_cb_pubpid"{{ filters.form_cb_pubpid ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_pubpid">{{ 'ID'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_policy" id="form_cb_policy"{{ filters.form_cb_policy ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_policy">{{ 'Policy'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_phone" id="form_cb_phone"{{ filters.form_cb_phone ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_phone">{{ 'Phone'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_city" id="form_cb_city"{{ filters.form_cb_city ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_city">{{ 'City'|xlt }}</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_ins1" id="form_cb_ins1"{{ filters.form_cb_ins1 ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_ins1">{{ 'Primary Ins'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_referrer" id="form_cb_referrer"{{ filters.form_cb_referrer ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_referrer">{{ 'Referrer'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_adate" id="form_cb_adate"{{ filters.form_cb_adate ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_adate">{{ 'Act Date'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_idays" id="form_cb_idays"{{ filters.form_cb_idays ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_idays">{{ 'Inactive Days'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_err" id="form_cb_err"{{ filters.form_cb_err ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_err">{{ 'Errors'|xlt }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="form_cb_group_number" id="form_cb_group_number"{{ filters.form_cb_group_number ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_group_number">{{ 'Group Number'|xlt }}</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    {# Filter Parameters Section #}
                    <div class="form-group mb-3">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="form_date" class="col-form-label">{{ 'Service Date'|xlt }}:</label>
                                <input type="text" class="datepicker form-control" name="form_date" id="form_date" size="10" value="{{ filters.form_date|default('')|attr }}">
                            </div>
                            <div class="col-md-3">
                                <label for="form_to_date" class="col-form-label">{{ 'To{{Range}}'|xlt }}:</label>
                                <input type="text" class="datepicker form-control" name="form_to_date" id="form_to_date" size="10" value="{{ filters.form_to_date|default('')|attr }}">
                            </div>
                            <div class="col-md-6">
                                <label for="form_category" class="col-form-label">{{ 'Category'|xlt }}:</label>
                                <select name="form_category" id="form_category" class="form-control">
                                    {% set categories = {'Open': 'Open'|xlt, 'Due Pt': 'Due Pt'|xlt, 'Due Ins': 'Due Ins'|xlt, 'Ins Summary': 'Ins Summary'|xlt, 'Credits': 'Credits'|xlt, 'All': 'All'|xlt} %}
                                    {% for key, value in categories %}
                                        <option value="{{ key|attr }}"{{ filters.form_category == key ? ' selected' : '' }}>{{ value }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="form_facility" class="col-form-label">{{ 'Facility'|xlt }}:</label>
                                {{ facility_dropdown|raw }}
                            </div>
                            <div class="col-md-6">
                                <label for="form_payer_id" class="col-form-label">{{ 'Payor'|xlt }}:</label>
                                {{ insurance_dropdown|raw }}
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="form_ageby" class="col-form-label">{{ 'Age By'|xlt }}:</label>
                                <select name="form_ageby" id="form_ageby" class="form-control">
                                    {% set age_options = {'Service Date': 'Service Date'|xlt, 'Last Activity Date': 'Last Activity Date'|xlt} %}
                                    {% for key, value in age_options %}
                                        <option value="{{ key|attr }}"{{ filters.form_ageby == value ? ' selected' : '' }}>{{ value }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="form_provider" class="col-form-label">{{ 'Provider'|xlt }}:</label>
                                {{ provider_dropdown|raw }}
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="form_age_cols" class="col-form-label">{{ 'Aging Columns'|xlt }}:</label>
                                <input type="text" name="form_age_cols" id="form_age_cols" class="form-control" size="2" value="{{ filters.form_age_cols|default(3)|attr }}">
                            </div>
                            <div class="col-md-3">
                                <label for="form_age_inc" class="col-form-label">{{ 'Days/Col'|xlt }}:</label>
                                <input type="text" name="form_age_inc" id="form_age_inc" class="form-control" size="3" value="{{ filters.form_age_inc|default(30)|attr }}">
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" name="form_cb_with_debt" id="form_cb_with_debt"{{ filters.form_cb_with_debt ? ' checked' : '' }}>
                                    <label class="form-check-label" for="form_cb_with_debt">{{ 'Patients with debt'|xlt }}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {# Submit and Print Buttons Section #}
                <div class="col-lg-3">
                    <div class="d-flex flex-column h-100 justify-content-center align-items-center border-left">
                        <div class="btn-group-vertical" role="group">
                            <button type="submit" class="btn btn-primary btn-lg mb-2" onclick="$('#form_refresh').val('true'); $('#form_export').val(''); $('#form_csvexport').val(''); $('#form_clear_ins_debt').val(''); return true;">
                                <i class="fa fa-search"></i> {{ 'Submit'|xlt }}
                            </button>
                            {% if show_results %}
                                <button type="button" class="btn btn-secondary" onclick="window.print();">
                                    <i class="fa fa-print"></i> {{ 'Print'|xlt }}
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
